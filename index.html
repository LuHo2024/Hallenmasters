<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hallenmasters - Live Scoreboard</title>
  <meta http-equiv="refresh" content="20">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: white;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .live-section, .schedule-section, .standings-section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }

    .section-title {
      font-size: 1.5em;
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #667eea;
    }

    .scoreboard {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      padding: 30px;
      color: white;
      text-align: center;
    }

    .scoreboard.no-live {
      background: linear-gradient(135deg, #999 0%, #666 100%);
    }

    .live-game-info {
      margin-bottom: 20px;
    }

    .live-game-info p {
      margin: 5px 0;
      font-size: 1em;
    }

    .scoreboard-content {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 20px;
      align-items: center;
      margin: 20px 0;
    }

    .team-section {
      padding: 15px;
    }

    .team-name-live {
      font-size: 1.2em;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .big-score {
      font-size: 3.5em;
      font-weight: bold;
    }

    .vs {
      font-size: 0.9em;
      font-weight: 600;
    }

    .timer {
      margin-top: 15px;
      font-size: 1.3em;
      font-weight: bold;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    table thead {
      background-color: #f5f5f5;
    }

    table th, table td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    table th {
      font-weight: 600;
      color: #333;
    }

    table tr:hover {
      background-color: #f9f9f9;
    }

    table tr.finished {
      color: #999;
      background-color: #f0f0f0;
    }

    .team-name {
      text-align: left;
    }

    .status {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
    }

    .status.pending {
      background-color: #e3f2fd;
      color: #1976d2;
    }

    .status.live {
      background-color: #ffebee;
      color: #c62828;
    }

    .status.finished {
      background-color: #f5f5f5;
      color: #666;
    }

    tr.top1 { background-color: #fffde7 !important; }
    tr.top2 { background-color: #f3e5f5 !important; }
    tr.top3 { background-color: #e0f2f1 !important; }

    @media (max-width: 768px) {
      body { padding: 10px; }
      .live-section, .schedule-section, .standings-section { padding: 15px; }
      h1 { font-size: 1.5em; margin-bottom: 20px; }
      .section-title { font-size: 1.2em; }
      .scoreboard { padding: 15px; }
      .big-score { font-size: 1.6em; }
      .team-name-live { font-size: 1em; }
      table th, table td { padding: 8px; font-size: 0.9em; }
    }

    @media (max-width: 420px) {
      body { padding: 8px; }
      .live-section, .schedule-section, .standings-section { padding: 10px; margin-bottom: 15px; }
      h1 { font-size: 1.2em; margin-bottom: 15px; }
      .section-title { font-size: 1em; margin-bottom: 10px; }
      .scoreboard { padding: 10px; }
      .big-score { font-size: 1.3em; }
      .team-name-live { font-size: 0.85em; }
      table th, table td { padding: 6px 3px; font-size: 0.75em; }
    }

    @media (max-width: 600px) {
      /* On very small screens keep both Team columns visible (columns 2 and 3).
         Hide less important columns (result/status) which are later columns. */
      table th:nth-child(n+4):nth-child(-n+9),
      table td:nth-child(n+4):nth-child(-n+9) {
        display: none;
      }

      /* Allow team names to wrap and use full width for readability */
      .schedule-section table th, .schedule-section table td { white-space: normal; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hallenmasters</h1>

    <div class="live-section">
      <div class="section-title">Live-Spielstand</div>
      <div class="scoreboard no-live">
        <div class="live-game-info">
          <p style="font-size: 1.1em; margin-bottom: 5px;">➡️ Nächstes Spiel</p>
          <p class="next-game">—</p>
        </div>
        <div class="scoreboard-content">
          <div class="team-section team1-section"><div class="team-name-live">—</div><div class="big-score">0</div></div>
          <div class="vs">vs</div>
          <div class="team-section team2-section"><div class="team-name-live">—</div><div class="big-score">0</div></div>
        </div>
        <div class="timer" data-end-time="">⏱️ Nächstes Spiel</div>
      </div>
    </div>

    <div class="schedule-section">
      <div class="section-title">Spielplan</div>
      <table>
        <thead>
          <tr>
            <th>Zeit</th>
            <th>Team 1</th>
            <th>Team 2</th>
            <th>Ergebnis</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <!-- schedule rows inserted here -->
        </tbody>
      </table>
    </div>

    <div class="standings-section">
      <div class="section-title">Rangliste</div>
      <table>
        <thead>
          <tr>
            <th>Platz</th>
            <th>Team</th>
            <th>Sp</th>
            <th>W</th>
            <th>D</th>
            <th>L</th>
            <th>GF</th>
            <th>GA</th>
            <th>Diff</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody>
          <!-- standings rows inserted here -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Client-side helper to format seconds as MM:SS
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
    }

    let gamesData = [];
    let teamsData = [];

    // Update timers on the page using the latest gamesData (live and time-left)
    function updateTimersFromData() {
      const liveSection = document.querySelector('.live-section');
      // Update live scoreboard if we have a live game
      const liveGame = gamesData.find(g => g.status === 'live');

      if (liveGame && liveSection) {
        const scoreboard = liveSection.querySelector('.scoreboard');
        scoreboard.classList.remove('no-live');
        scoreboard.querySelector('.team1-section .team-name-live').textContent = liveGame.team1 || '';
        scoreboard.querySelector('.team2-section .team-name-live').textContent = liveGame.team2 || '';
        scoreboard.querySelector('.team1-section .big-score').textContent = liveGame.score1 || 0;
        scoreboard.querySelector('.team2-section .big-score').textContent = liveGame.score2 || 0;
        // compute time left
        let tl = '';
        if (liveGame.startTime && liveGame.duration) {
          const left = Math.max(0, (liveGame.duration) - (Math.floor(Date.now()/1000) - liveGame.startTime));
          tl = '⏱️ ' + formatTime(left);
        } else if (liveGame.timeLeft) {
          tl = '⏱️ ' + formatTime(liveGame.timeLeft);
        }
        const timerEl = scoreboard.querySelector('.timer');
        if (timerEl) timerEl.textContent = tl || '⏱️ Startet bald';
        const nextGameEl = liveSection.querySelector('.next-game');
        if (nextGameEl) nextGameEl.textContent = (liveGame.time || '') + ' — ' + (liveGame.team1||'') + ' vs ' + (liveGame.team2||'');
      } else if (liveSection) {
        const scoreboard = liveSection.querySelector('.scoreboard');
        scoreboard.classList.add('no-live');
        scoreboard.querySelector('.team1-section .team-name-live').textContent = '—';
        scoreboard.querySelector('.team2-section .team-name-live').textContent = '—';
        scoreboard.querySelector('.team1-section .big-score').textContent = '0';
        scoreboard.querySelector('.team2-section .big-score').textContent = '0';
        const timerEl = scoreboard.querySelector('.timer');
        if (timerEl) timerEl.textContent = '⏱️ Nächstes Spiel';
        const nextGameEl = liveSection.querySelector('.next-game');
        if (nextGameEl) nextGameEl.textContent = '—';
      }

      // Update schedule table time-left columns if present
      const rows = document.querySelectorAll('.schedule-section tbody tr');
      rows.forEach(row => {
        const gid = parseInt(row.dataset.gid);
        const g = gamesData.find(x => x.id === gid);
        if (!g) return;
        const scoreEl = row.querySelector('.score');
        if (scoreEl) scoreEl.textContent = (g.score1 || 0) + ' - ' + (g.score2 || 0);
        const statusEl = row.querySelector('.status');
        if (statusEl) {
          statusEl.textContent = (g.status || '');
          statusEl.className = 'status ' + (g.status || 'pending');
        }
      });
    }

    // Fetch latest games (and teams) JSON and re-render portions
    async function fetchGamesAndTeams() {
      try {
        const gResp = await fetch('games_data.json?t=' + Date.now());
        if (gResp.ok) {
          gamesData = await gResp.json();
        }
        const tResp = await fetch('teams.json?t=' + Date.now());
        if (tResp.ok) {
          teamsData = await tResp.json();
        }
        renderSchedule();
        renderStandings();
        updateTimersFromData();
      } catch (e) {
        console.log('Failed to fetch games/teams:', e);
      }
    }

    function renderSchedule() {
      const tb = document.querySelector('.schedule-section tbody');
      if (!tb) return;
      tb.innerHTML = '';
      gamesData.forEach(g => {
        const tr = document.createElement('tr');
        tr.dataset.gid = g.id || '';
        if ((g.status || '') === 'finished') tr.classList.add('finished');
        tr.innerHTML = `
          <td>${escapeHtml(g.time || '')}</td>
          <td class="team-name">${escapeHtml(g.team1 || '')}</td>
          <td class="team-name">${escapeHtml(g.team2 || '')}</td>
          <td class="score">${(g.score1||0)} - ${(g.score2||0)}</td>
          <td><span class="status ${escapeHtml(g.status||'pending')}">${escapeHtml(g.status||'')}</span></td>
        `;
        tb.appendChild(tr);
      });
    }

    function renderStandings() {
      const tb = document.querySelector('.standings-section tbody');
      if (!tb) return;
      tb.innerHTML = '';
      teamsData.forEach((r, idx) => {
        const tr = document.createElement('tr');
        if (idx === 0) tr.classList.add('top1');
        if (idx === 1) tr.classList.add('top2');
        if (idx === 2) tr.classList.add('top3');
        tr.innerHTML = `<td>${idx+1}</td><td style="text-align:left;">${escapeHtml(r.team||'')}</td><td>${r.played||0}</td><td>${r.wins||0}</td><td>${r.draws||0}</td><td>${r.losses||0}</td><td>${r.gf||0}</td><td>${r.ga||0}</td><td>${r.diff||0}</td><td>${r.points||0}</td>`;
        tb.appendChild(tr);
      });
    }

    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // initial fetch and intervals
    fetchGamesAndTeams();
    // update live timers from data every second
    setInterval(updateTimersFromData, 1000);
    // re-fetch games/teams every 5 seconds (page meta-refresh still triggers full reload every 20s)
    setInterval(fetchGamesAndTeams, 5000);
  </script>
</body>
</html>
